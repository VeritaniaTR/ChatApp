<Window x:Class="ChatApp.Client.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ChatApp.Client.Views"
        xmlns:vm="clr-namespace:ChatApp.Client.ViewModels"
        Title="WPF Чат Клієнт" Height="450" Width="600">
    <Window.DataContext>
        <vm:MainWindowViewModel/>
    </Window.DataContext>
    <Window.Resources>
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="200"/>
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal" Margin="5">
            <TextBlock Text="Нікнейм:" Margin="5"/>
            <TextBox x:Name="NicknameTextBox" Width="100" Margin="5" Text="{Binding Nickname, UpdateSourceTrigger=PropertyChanged}"/>
            <TextBlock Text="IP Адреса:" Margin="5"/>
            <TextBox Text="{Binding ServerIp, UpdateSourceTrigger=PropertyChanged}" Width="120" Margin="5"/>
            <TextBlock Text="Порт:" Margin="5"/>
            <TextBox Text="{Binding ServerPort, UpdateSourceTrigger=PropertyChanged}" Width="60" Margin="5"/>
            <Button Content="{Binding ConnectionStatus}" Margin="5" Command="{Binding ConnectCommand}" IsEnabled="{Binding !IsConnected}"/>
            <Button Content="Відключитися" Margin="5" Command="{Binding DisconnectCommand}" IsEnabled="{Binding IsConnected}"/>
            <TextBlock Text="{Binding ConnectionStatus}" Margin="10,5,5,5" Foreground="{Binding ConnectionStatusColor}"/>
        </StackPanel>

        <ScrollViewer Grid.Row="1" Grid.Column="0" Margin="5" VerticalScrollBarVisibility="Auto" x:Name="ChatScrollViewer">
            <ListBox x:Name="ChatListBox" ItemsSource="{Binding ChatMessages}" BorderThickness="0">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Vertical">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Timestamp, StringFormat='HH:mm:ss'}"/>
                                <TextBlock Text=" - "/>
                                <TextBlock Text="{Binding Sender}"/>
                                <TextBlock Text=": "/>
                                <TextBlock Text="{Binding Text}" Visibility="{Binding IsImage, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Collapsed}"/>
                            </StackPanel>
                            <Image Source="{Binding Image}" Visibility="{Binding IsImage, Converter={StaticResource BooleanToVisibilityConverter}}" MaxWidth="200" MaxHeight="200"/>
                            <TextBlock Text="{Binding FilePath}" Visibility="{Binding IsImage, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Collapsed}" FontStyle="Italic"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
                <ListBox.ItemContainerStyle>
                    <Style TargetType="ListBoxItem">
                        <Setter Property="Focusable" Value="False"/>
                        <Setter Property="Padding" Value="2"/>
                    </Style>
                </ListBox.ItemContainerStyle>
            </ListBox>
        </ScrollViewer>

        <Border Grid.Row="0" Grid.RowSpan="4" Grid.Column="1" BorderBrush="LightGray" BorderThickness="1" Margin="5">
            <StackPanel>
                <TextBlock Text="Онлайн користувачі:" FontWeight="Bold" Margin="5"/>
                <ListBox ItemsSource="{Binding OnlineUsers}" BorderThickness="0" Background="Transparent" />
            </StackPanel>
        </Border>

        <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Horizontal" Margin="5" HorizontalAlignment="Stretch">
            <TextBox Margin="0,0,5,0" Height="30" Text="{Binding MessageToSend, UpdateSourceTrigger=PropertyChanged}" KeyDown="MessageTextBox_KeyDown" VerticalAlignment="Stretch" Width="99"/>
            <Button Content="Відправити" Margin="0,0,5,0" Width="100" Command="{Binding SendCommand}"/>
        </StackPanel>

        <StackPanel Grid.Row="3" Grid.Column="0" Orientation="Horizontal" Margin="5">
            <Button Content="Надіслати файл" Margin="0,0,5,0" Width="100" Command="{Binding SendFileCommand}" IsEnabled="{Binding IsConnected}"/>
            <ProgressBar Value="{Binding FileTransferProgress}" Width="200" Height="20" Minimum="0" Maximum="100" Visibility="{Binding IsFileTransferring, Converter={StaticResource BooleanToVisibilityConverter}}"/>
            <TextBlock Text="{Binding FileTransferProgress, StringFormat='{} {0}%'}" Margin="5,0,0,0" VerticalAlignment="Center" Visibility="{Binding IsFileTransferring, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </StackPanel>
    </Grid>
</Window>